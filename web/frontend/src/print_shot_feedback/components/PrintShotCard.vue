<template>
  <div>
    <img class="card-img-top" :src="shot.image_url" />
    <div class="px-3 pt-4">
      <b-form-group label="Do you see any spaghetti in this picture?">
        <b-form-radio-group
          v-model="answer"
          :options="options"
          @change="updateShot"
        ></b-form-radio-group>
      </b-form-group>
      <small class="text-muted">
        Not sure? Look at
        <a
          href="https://www.thespaghettidetective.com/docs/how-does-credits-work/#spaghetti-examples"
        >some examples >>></a>
      </small>
    </div>
  </div>
</template>

<script>
import axios from 'axios'

import apis from '../../lib/apis'
import { BFormGroup, BFormRadioGroup} from 'bootstrap-vue'

export default {
  name: 'PrintShotCard',

  components: {
    BFormGroup,
    BFormRadioGroup,
  },

  props: {
    shot: Object
  },

  data() {
    return {
      answer: this.shot.answer,
      options: [
        { text: 'Yes', value: 'LOOKS_BAD' },
        { text: 'No', value: 'LOOKS_OK' },
        { text: 'I am not sure', value: 'UNDECIDED' },
      ]
    }
  },

  methods: {
    updateShot: function(answer) {
      axios
        .put(apis.printShotFeedback(this.shot.id, this.shot.print_id), {
          answer: answer
        })

        .then(response => {
          const { instance, credited_dhs } = response.data
          this.$emit('shotChanged', instance)
          if (credited_dhs > 0) {
            this.$swal({
              title: 'You are awesome!',
              html:
                '<p>The Detective just got a little smarter because of your feedback!</p><p>You just earned 2 non-expirable Detective Hours - Yay!</p>',
              confirmButtonText: 'I\'m done!',
              showCancelButton: true,
              cancelButtonText: 'Change feedback'
            }).then(result => {
              if (result.isConfirmed) {
                window.location.href = '/prints/'
              }
            })
          }
        })
    }
  }
}
</script>

<style></style>
