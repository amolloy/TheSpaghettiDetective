<template>
<div>
  <div class="row my-2">
    <div
      v-if="!printer.isOffline && printer.hasError"
      class="col-12 bg-danger text-center">
      <div>OctoPrint Error</div><div>{{ printer.status.state.text }}</div>
    </div>

    <div
      v-if="!printer.isOffline && !printer.isDisconnected && !printer.isIdle"
      class="col-sm-6"
    >
      <button
        v-if="!printer.isPaused"
        type="button"
        class="btn btn-block mt-2 btn-outline-warning"
        @click="onPauseToggled($event)"
      >
        <i class="fas fa-pause"></i>&nbsp;Pause
      </button>
      <button
        v-else
        type="button"
        class="btn btn-block mt-2 btn-outline-success"
        @click="onPauseToggled($event)"
      >
        <i class="fas fa-play"></i>&nbsp;Resume
      </button>
    </div>

    <div
      v-if="!printer.isOffline && !printer.isDisconnected && !printer.isIdle"
      class="col-sm-6"
    >
      <button
        id="print-cancel"
        type="button"
        class="btn btn-outline-danger btn-block mt-2 mb-2"
        @click="$emit('PrinterActionCancelClicked', $event)"
      >
        <i class="fas fa-stop"></i>&nbsp;Cancel
      </button>
    </div>


    <div
      v-if="!printer.isOffline && !printer.isDisconnected && printer.isIdle"
      class="col-sm-6"
    >
      <button
        id="start-print"
        type="button"
        class="btn btn-outline-primary btn-block mt-2"
        @click="$emit('PrinterActionStartClicked', $event)"
      >
        <i class="fas fa-star"></i>&nbsp;&nbsp;Start Printing
      </button>
    </div>

    <div
      v-if="!printer.isOffline && !printer.isDisconnected && printer.isIdle"
      class="col-sm-6"
    >
      <a
        type="button"
        role="button"
        class="btn btn-outline-secondary btn-block mt-2 mb-2"
        @click="$emit('PrinterActionControlClicked', $event)"
      >
        <i class="fas fa-arrows-alt"></i>&nbsp;&nbsp;Control
      </a>
    </div>

    <div
      v-if="!printer.isOffline && printer.isDisconnected"
      class="col-12 text-center py-2 text-warning"
    >
      <div>Printer is not connected to OctoPrint.</div>
      <button
        id="connect-printer"
        type="button"
        class="btn btn-outline-primary btn-block mt-2"
        :disabled="connecting"
        @click="this.onConnectClicked"
      >
        <b-spinner v-if="connecting" type="grow" small></b-spinner>
        <i v-else class="fab fa-usb"></i>
        &nbsp;&nbsp;Connect
      </button>
    </div>

    <div
      v-if="printer.isOffline"
      class="col-12 text-center py-3 text-warning"
    >
      <div>
        OctoPrint is not powered on, or is offline.
        <a href="https://www.thespaghettidetective.com/docs/octoprint-is-offline/">Why?</a>
      </div>
    </div>
  </div>
</div>
</template>

<script>

export default {
  name: 'PrinterActions',
  props: {
    printer: {},
  },
  data() {
    return {
      connectBtnClicked: false,
    }
  },
  computed: {
    connecting() {
      return this.connectBtnClicked && this.printer.isDisconnected
    }
  },
  methods: {
    onPauseToggled(ev) {
      if (this.printer.isPaused) {
        this.$emit('PrinterActionResumeClicked', ev)
      } else {
        this.$emit('PrinterActionPauseClicked', ev)
      }
    },
    onConnectClicked(ev) {
      this.$emit('PrinterActionConnectClicked', ev)
      this.connectBtnClicked = true
      setTimeout( () => {this.connectBtnClicked = false}, 10*1000)

    }
  }
}
</script>
